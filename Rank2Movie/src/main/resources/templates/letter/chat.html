<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Title</title>
        <!-- JQuery -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js"
            integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>
        <!-- SockJS -->
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.6.1/sockjs.min.js"
            integrity="sha512-1QvjE7BtotQjkq8PxLeF6P46gEpBRXuskzIVgjFpekzFVF4yjRgrQvTG1MTOJ3yQgvTteKAcO7DSZI92+u/yZw=="
            crossorigin="anonymous"
            referrerpolicy="no-referrer"></script>

        <style>
            .removeSB::-webkit-scrollbar {
                display: none;
                width: 0 !important;
            }
        </style>

    </head>
    <body>

        <div
            id="chatBox"
            style="width: 400px; height: 500px; border-style: solid; border-width: 1px;">
            <div
                id="chat"
                class="removeSB"
                style="height: 95%; overflow: scroll; background-color: aliceblue; scrollbar-width: 0;"></div>
            <input
                id="txt_send"
                onkeydown="keyDownEvent(event)"
                type="text"
                style="width: 80%;">
            <button sec:authorize="isAuthenticated()" onclick="sendMessage()">보내기</button>
        </div>

        <script>
            let socket = new SockJS("/chat");
            socket.onopen = () => console.log("Info : connection opened");
            socket.onmessage = msgEvent;
            socket.onclose = () => console.log("Info : connection closed");
            socket.onerror = err => console.log(err);

            function msgEvent(message) {

                console.log("message : " + message.data);

                $("#chat").append(message.data + "<br>");
                document.getElementById("chat").scrollTop = document.getElementById("chat").scrollHeight;
            
            }

            function keyDownEvent(e) {
                if (e.keyCode === 13) {
                    sendMessage();
                }
            }

            function sendMessage() {
                var str = $("#txt_send").val();
                if (str == "") 
                    return;
                
                socket.send(str);
                $("#txt_send").val("");
            }
        </script>

    </body>
</html>