<html layout:decorate="~{layout}" xmlns:layout="http://www.w3.org/1999/xhtml">  <!--템플릿 상속-->
<div layout:fragment="content" class="container">   <!-- layout의 content fragment에 삽입 -->



        <link rel="stylesheet" href="/css/movie/detail.css" />
    <div class="container">
        <div class="movieWrapper">
            <img src="/image/3351384.png" alt="" class="posterImage" />
            <div class="movieInfoBox">
                <h1>아무튼 개쩌는 영화</h1>
                <ul>
                    <li>스티브 존 애덤스</li>
                    <li>2022.22.22</li>
                    <li>코카콜라</li>
                    <li>청소년시청불가</li>
                </ul>
            </div>
            <div class="movieSynopsysBox">
					<textarea readonly>
                    </textarea>
            </div>
            <button id="posting" onclick="">이 영화 글쓰기</button>
        </div>

        <div class="boardWrapper">
            <iframe src="../movie/inserted_board.html" frameborder="0" width="100%" height="100%">크롬 브라우저를 이용해주세요.</iframe>
        </div>
    </div>


    

    <script>
        /*
        ** 영화 JSON 포맷(data.movie) **
        movieCode : 영화 코드
        titleKor : 한국 제목
        titleEn : 영어 제목
        genre : 장르('/'로 구분된 여러 장르들)
        actor : 배우 ('/'로 구분된 여러 장르들)

        showTime : 상영시간
        company : 배급사 등등의 이름
        director : 감독들
        productStatus : 제작상태(개봉/개봉예정)
        productYear : 제작년도
        nation : 국적

        imageUrl : 이미지 URL
        views : 조회수

        avrRating : 평가(평가가 없으면 null 처리 되도록 했다.)

        */

        /*
        게시물은 아예 다른 AJAX로 빼버렸다.(생각해보니 게시물 리스트도 페이징 해줘야함..)
        */
       
        var page = 0; // 현재 보고 있는 게시물의 페이지

        const urlParams = new URL(location.href).searchParams;
        const code = urlParams.get('code');
        // test용
        console.log(code)

        $.ajax({
            url : "/movie/",
            data : {code : code},
            method : "GET",
            success : successFunc,
            error : e => alert(e.responseText)
        });

        pageChange(0);

        function pageChange(num)
        {
            page = num;
            $.ajax({
                url : "/board/movie_list",
                data : {code : code, page : page},
                method : "GET",
                success : successBoard,
                error : e => alert(e.responseText)
            });

        }

        // 영화 AJAX가 성공했을때 실행되는 함수
        function successFunc(data)
        {
            console.log(data);

            $(".movieInfoBox > h1").html(JSON.stringify(data.movie.titleKor));
            $(".genre").html(JSON.stringify(data.movie.genre));
            $(".company").html(JSON.stringify(data.movie.company));
            $(".director").html(JSON.stringify(data.movie.director));
            $(".productYear").src = JSON.stringify(data.movie.imageUrl);


            // 글쓰기로 이동하는 이벤트
            $("#posting").click( () => location.href = "/board/posting?code=" + data.movie.movieCode);

        }
        
        function successBoard(data)
        {
            // 만약 게시물이 없다면, pageLast는 -1이 된다.
            console.log(data);

        }

        

    </script>

</div>
</html>